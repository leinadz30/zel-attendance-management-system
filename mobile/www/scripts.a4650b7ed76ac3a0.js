!function(K){"object"==typeof exports&&typeof module<"u"?module.exports=K():"function"==typeof define&&define.amd?define([],K):(typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this).adapter=K()}(function(){return function x(U,R,c){function s(m,C){if(!R[m]){if(!U[m]){var _="function"==typeof require&&require;if(!C&&_)return _(m,!0);if(o)return o(m,!0);var P=new Error("Cannot find module '"+m+"'");throw P.code="MODULE_NOT_FOUND",P}var v=R[m]={exports:{}};U[m][0].call(v.exports,function(E){return s(U[m][1][E]||E)},v,v.exports,x,U,R,c)}return R[m].exports}for(var o="function"==typeof require&&require,p=0;p<c.length;p++)s(c[p]);return s}({1:[function(x,U,R){"use strict";var s=(0,x("./adapter_factory.js").adapterFactory)({window:typeof window>"u"?void 0:window});U.exports=s},{"./adapter_factory.js":2}],2:[function(x,U,R){"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.adapterFactory=function n(){var h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=h.window,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},t=s.log,r=s.detectBrowser(i),a={browserDetails:r,commonShim:S,extractVersion:s.extractVersion,disableLog:s.disableLog,disableWarnings:s.disableWarnings};switch(r.browser){case"chrome":if(!p||!p.shimPeerConnection||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),a;if(null===r.version)return t("Chrome shim can not determine version, not shimming."),a;t("adapter.js shimming chrome."),a.browserShim=p,S.shimAddIceCandidateNullOrEmpty(i,r),p.shimGetUserMedia(i,r),p.shimMediaStream(i,r),p.shimPeerConnection(i,r),p.shimOnTrack(i,r),p.shimAddTrackRemoveTrack(i,r),p.shimGetSendersWithDtmf(i,r),p.shimGetStats(i,r),p.shimSenderReceiverGetStats(i,r),p.fixNegotiationNeeded(i,r),S.shimRTCIceCandidate(i,r),S.shimConnectionState(i,r),S.shimMaxMessageSize(i,r),S.shimSendThrowTypeError(i,r),S.removeExtmapAllowMixed(i,r);break;case"firefox":if(!P||!P.shimPeerConnection||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),a;t("adapter.js shimming firefox."),a.browserShim=P,S.shimAddIceCandidateNullOrEmpty(i,r),P.shimGetUserMedia(i,r),P.shimPeerConnection(i,r),P.shimOnTrack(i,r),P.shimRemoveStream(i,r),P.shimSenderGetStats(i,r),P.shimReceiverGetStats(i,r),P.shimRTCDataChannel(i,r),P.shimAddTransceiver(i,r),P.shimGetParameters(i,r),P.shimCreateOffer(i,r),P.shimCreateAnswer(i,r),S.shimRTCIceCandidate(i,r),S.shimConnectionState(i,r),S.shimMaxMessageSize(i,r),S.shimSendThrowTypeError(i,r);break;case"edge":if(!C||!C.shimPeerConnection||!e.shimEdge)return t("MS edge shim is not included in this adapter release."),a;t("adapter.js shimming edge."),a.browserShim=C,C.shimGetUserMedia(i,r),C.shimGetDisplayMedia(i,r),C.shimPeerConnection(i,r),C.shimReplaceTrack(i,r),S.shimMaxMessageSize(i,r),S.shimSendThrowTypeError(i,r);break;case"safari":if(!E||!e.shimSafari)return t("Safari shim is not included in this adapter release."),a;t("adapter.js shimming safari."),a.browserShim=E,S.shimAddIceCandidateNullOrEmpty(i,r),E.shimRTCIceServerUrls(i,r),E.shimCreateOfferLegacy(i,r),E.shimCallbacksAPI(i,r),E.shimLocalStreamsAPI(i,r),E.shimRemoteStreamsAPI(i,r),E.shimTrackEventTransceiver(i,r),E.shimGetUserMedia(i,r),E.shimAudioContext(i,r),S.shimRTCIceCandidate(i,r),S.shimMaxMessageSize(i,r),S.shimSendThrowTypeError(i,r),S.removeExtmapAllowMixed(i,r);break;default:t("Unsupported browser!")}return a};var s=D(x("./utils")),p=D(x("./chrome/chrome_shim")),C=D(x("./edge/edge_shim")),P=D(x("./firefox/firefox_shim")),E=D(x("./safari/safari_shim")),S=D(x("./common_shim"));function D(h){if(h&&h.__esModule)return h;var i={};if(null!=h)for(var e in h)Object.prototype.hasOwnProperty.call(h,e)&&(i[e]=h[e]);return i.default=h,i}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(x,U,R){"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.shimGetDisplayMedia=R.shimGetUserMedia=void 0;var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=x("./getusermedia");Object.defineProperty(R,"shimGetUserMedia",{enumerable:!0,get:function(){return s.shimGetUserMedia}});var o=x("./getdisplaymedia");Object.defineProperty(R,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}}),R.shimMediaStream=function P(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},R.shimOnTrack=function v(e){if("object"===(typeof e>"u"?"undefined":c(e))&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(a){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=a)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var a=this;return this._ontrackpoly||(this._ontrackpoly=function(f){f.stream.addEventListener("addtrack",function(d){var u;u=e.RTCPeerConnection.prototype.getReceivers?a.getReceivers().find(function(T){return T.track&&T.track.id===d.track.id}):{track:d.track};var l=new Event("track");l.track=d.track,l.receiver=u,l.transceiver={receiver:u},l.streams=[f.stream],a.dispatchEvent(l)}),f.stream.getTracks().forEach(function(d){var u;u=e.RTCPeerConnection.prototype.getReceivers?a.getReceivers().find(function(T){return T.track&&T.track.id===d.id}):{track:d};var l=new Event("track");l.track=d,l.receiver=u,l.transceiver={receiver:u},l.streams=[f.stream],a.dispatchEvent(l)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else m.wrapPeerConnectionEvent(e,"track",function(r){return r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r})},R.shimGetSendersWithDtmf=function E(e){if("object"===(typeof e>"u"?"undefined":c(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(T,g){return{track:g,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===g.kind?T.createDTMFSender(g):null),this._dtmf},_pc:T}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(T,g){var y=r.apply(this,arguments);return y||(y=t(this,T),this._senders.push(y)),y};var a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(T){a.apply(this,arguments);var g=this._senders.indexOf(T);-1!==g&&this._senders.splice(g,1)}}var f=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(T){var g=this;this._senders=this._senders||[],f.apply(this,[T]),T.getTracks().forEach(function(y){g._senders.push(t(g,y))})};var d=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(T){var g=this;this._senders=this._senders||[],d.apply(this,[T]),T.getTracks().forEach(function(y){var M=g._senders.find(function(b){return b.track===y});M&&g._senders.splice(g._senders.indexOf(M),1)})}}else if("object"===(typeof e>"u"?"undefined":c(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var u=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var T=this,g=u.apply(this,[]);return g.forEach(function(y){return y._pc=T}),g},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}},R.shimGetStats=function k(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var a=this,f=Array.prototype.slice.call(arguments),d=f[0],u=f[1],l=f[2];if(arguments.length>0&&"function"==typeof d)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof d))return t.apply(this,[]);var T=function(b){var O={};return b.result().forEach(function(A){var L={id:A.id,timestamp:A.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[A.type]||A.type};A.names().forEach(function(F){L[F]=A.stat(F)}),O[L.id]=L}),O},g=function(b){return new Map(Object.keys(b).map(function(O){return[O,b[O]]}))};if(arguments.length>=2){var y=function(b){u(g(T(b)))};return t.apply(this,[y,d])}return new Promise(function(M,b){t.apply(a,[function(O){M(g(T(O)))},b])}).then(u,l)}}},R.shimSenderReceiverGetStats=function S(e){if("object"===(typeof e>"u"?"undefined":c(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var u=this,l=t.apply(this,[]);return l.forEach(function(T){return T._pc=u}),l});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var u=r.apply(this,arguments);return u._pc=this,u}),e.RTCRtpSender.prototype.getStats=function(){var u=this;return this._pc.getStats().then(function(l){return m.filterStats(l,u.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var a=e.RTCPeerConnection.prototype.getReceivers;a&&(e.RTCPeerConnection.prototype.getReceivers=function(){var u=this,l=a.apply(this,[]);return l.forEach(function(T){return T._pc=u}),l}),m.wrapPeerConnectionEvent(e,"track",function(d){return d.receiver._pc=d.srcElement,d}),e.RTCRtpReceiver.prototype.getStats=function(){var u=this;return this._pc.getStats().then(function(l){return m.filterStats(l,u.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var f=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var u=arguments[0],l=void 0,T=void 0,g=void 0;return this.getSenders().forEach(function(y){y.track===u&&(l?g=!0:l=y)}),this.getReceivers().forEach(function(y){return y.track===u&&(T?g=!0:T=y),y.track===u}),g||l&&T?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):l?l.getStats():T?T.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return f.apply(this,arguments)}}}},R.shimAddTrackRemoveTrackWithNative=D,R.shimAddTrackRemoveTrack=function n(e,t){if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return D(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var y=this,M=r.apply(this);return this._reverseStreams=this._reverseStreams||{},M.map(function(b){return y._reverseStreams[b.id]})};var a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(y){var M=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},y.getTracks().forEach(function(O){if(M.getSenders().find(function(A){return A.track===O}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[y.id]){var b=new e.MediaStream(y.getTracks());this._streams[y.id]=b,this._reverseStreams[b.id]=y,y=b}a.apply(this,[y])};var f=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(y){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},f.apply(this,[this._streams[y.id]||y]),delete this._reverseStreams[this._streams[y.id]?this._streams[y.id].id:y.id],delete this._streams[y.id]},e.RTCPeerConnection.prototype.addTrack=function(y,M){var b=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var O=[].slice.call(arguments,1);if(1!==O.length||!O[0].getTracks().find(function(F){return F===y}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var G=this.getSenders().find(function(F){return F.track===y});if(G)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var A=this._streams[M.id];if(A)A.addTrack(y),Promise.resolve().then(function(){b.dispatchEvent(new Event("negotiationneeded"))});else{var L=new e.MediaStream([y]);this._streams[M.id]=L,this._reverseStreams[L.id]=M,this.addStream(L)}return this.getSenders().find(function(F){return F.track===y})},["createOffer","createAnswer"].forEach(function(g){var y=e.RTCPeerConnection.prototype[g],M=_({},g,function(){var b=this,O=arguments,G=arguments.length&&"function"==typeof arguments[0];return G?y.apply(this,[function(A){var L=d(b,A);O[0].apply(null,[L])},function(A){O[1]&&O[1].apply(null,A)},arguments[2]]):y.apply(this,arguments).then(function(A){return d(b,A)})});e.RTCPeerConnection.prototype[g]=M[g]});var l=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=u(this,arguments[0]),l.apply(this,arguments)):l.apply(this,arguments)};var T=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var y=T.get.apply(this);return""===y.type?y:d(this,y)}}),e.RTCPeerConnection.prototype.removeTrack=function(y){var M=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!y._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(y._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var O=void 0;Object.keys(this._streams).forEach(function(G){M._streams[G].getTracks().find(function(L){return y.track===L})&&(O=M._streams[G])}),O&&(1===O.getTracks().length?this.removeStream(this._reverseStreams[O.id]):O.removeTrack(y.track),this.dispatchEvent(new Event("negotiationneeded")))}}function d(g,y){var M=y.sdp;return Object.keys(g._reverseStreams||[]).forEach(function(b){var O=g._reverseStreams[b];M=M.replace(new RegExp(g._streams[O.id].id,"g"),O.id)}),new RTCSessionDescription({type:y.type,sdp:M})}function u(g,y){var M=y.sdp;return Object.keys(g._reverseStreams||[]).forEach(function(b){var O=g._reverseStreams[b],G=g._streams[O.id];M=M.replace(new RegExp(O.id,"g"),G.id)}),new RTCSessionDescription({type:y.type,sdp:M})}},R.shimPeerConnection=function h(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){var a=e.RTCPeerConnection.prototype[r],f=_({},r,function(){return arguments[0]=new("addIceCandidate"===r?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)});e.RTCPeerConnection.prototype[r]=f[r]})},R.fixNegotiationNeeded=function i(e,t){m.wrapPeerConnectionEvent(e,"negotiationneeded",function(r){var a=r.target;if(!(t.version<72||a.getConfiguration&&"plan-b"===a.getConfiguration().sdpSemantics)||"stable"===a.signalingState)return r})};var m=function C(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(x("../utils.js"));function _(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function D(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var u=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(l){return u._shimmedLocalStreams[l][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(u,l){if(!l)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var T=t.apply(this,arguments);return this._shimmedLocalStreams[l.id]?-1===this._shimmedLocalStreams[l.id].indexOf(T)&&this._shimmedLocalStreams[l.id].push(T):this._shimmedLocalStreams[l.id]=[l,T],T};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(u){var l=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},u.getTracks().forEach(function(y){if(l.getSenders().find(function(b){return b.track===y}))throw new DOMException("Track already exists.","InvalidAccessError")});var T=this.getSenders();r.apply(this,arguments);var g=this.getSenders().filter(function(y){return-1===T.indexOf(y)});this._shimmedLocalStreams[u.id]=[u].concat(g)};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[u.id],a.apply(this,arguments)};var f=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(u){var l=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},u&&Object.keys(this._shimmedLocalStreams).forEach(function(T){var g=l._shimmedLocalStreams[T].indexOf(u);-1!==g&&l._shimmedLocalStreams[T].splice(g,1),1===l._shimmedLocalStreams[T].length&&delete l._shimmedLocalStreams[T]}),f.apply(this,arguments)}}},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(x,U,R){"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.shimGetDisplayMedia=function c(s,o){if((!s.navigator.mediaDevices||!("getDisplayMedia"in s.navigator.mediaDevices))&&s.navigator.mediaDevices){if("function"!=typeof o)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");s.navigator.mediaDevices.getDisplayMedia=function(m){return o(m).then(function(C){var _=m.video&&m.video.width,P=m.video&&m.video.height;return m.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:C,maxFrameRate:m.video&&m.video.frameRate||3}},_&&(m.video.mandatory.maxWidth=_),P&&(m.video.mandatory.maxHeight=P),s.navigator.mediaDevices.getUserMedia(m)})}}}},{}],5:[function(x,U,R){"use strict";Object.defineProperty(R,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(_){return typeof _}:function(_){return _&&"function"==typeof Symbol&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _};R.shimGetUserMedia=function C(_,P){var v=_&&_.navigator;if(v.mediaDevices){var E=function(i){if("object"!==(typeof i>"u"?"undefined":c(i))||i.mandatory||i.optional)return i;var e={};return Object.keys(i).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var r="object"===c(i[t])?i[t]:{ideal:i[t]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var a=function(u,l){return u?u+l.charAt(0).toUpperCase()+l.slice(1):"deviceId"===l?"sourceId":l};if(void 0!==r.ideal){e.optional=e.optional||[];var f={};"number"==typeof r.ideal?(f[a("min",t)]=r.ideal,e.optional.push(f),(f={})[a("max",t)]=r.ideal,e.optional.push(f)):(f[a("",t)]=r.ideal,e.optional.push(f))}void 0!==r.exact&&"number"!=typeof r.exact?(e.mandatory=e.mandatory||{},e.mandatory[a("",t)]=r.exact):["min","max"].forEach(function(d){void 0!==r[d]&&(e.mandatory=e.mandatory||{},e.mandatory[a(d,t)]=r[d])})}}),i.advanced&&(e.optional=(e.optional||[]).concat(i.advanced)),e},k=function(i,e){if(P.version>=61)return e(i);if((i=JSON.parse(JSON.stringify(i)))&&"object"===c(i.audio)){var t=function(u,l,T){l in u&&!(T in u)&&(u[T]=u[l],delete u[l])};t((i=JSON.parse(JSON.stringify(i))).audio,"autoGainControl","googAutoGainControl"),t(i.audio,"noiseSuppression","googNoiseSuppression"),i.audio=E(i.audio)}if(i&&"object"===c(i.video)){var r=i.video.facingMode;r=r&&("object"===(typeof r>"u"?"undefined":c(r))?r:{ideal:r});var a=P.version<66;if(r&&("user"===r.exact||"environment"===r.exact||"user"===r.ideal||"environment"===r.ideal)&&(!v.mediaDevices.getSupportedConstraints||!v.mediaDevices.getSupportedConstraints().facingMode||a)){delete i.video.facingMode;var f=void 0;if("environment"===r.exact||"environment"===r.ideal?f=["back","rear"]:("user"===r.exact||"user"===r.ideal)&&(f=["front"]),f)return v.mediaDevices.enumerateDevices().then(function(d){var u=(d=d.filter(function(l){return"videoinput"===l.kind})).find(function(l){return f.some(function(T){return l.label.toLowerCase().includes(T)})});return!u&&d.length&&f.includes("back")&&(u=d[d.length-1]),u&&(i.video.deviceId=r.exact?{exact:u.deviceId}:{ideal:u.deviceId}),i.video=E(i.video),m("chrome: "+JSON.stringify(i)),e(i)})}i.video=E(i.video)}return m("chrome: "+JSON.stringify(i)),e(i)},S=function(i){return P.version>=64?i:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[i.name]||i.name,message:i.message,constraint:i.constraint||i.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(v.getUserMedia=function(i,e,t){k(i,function(r){v.webkitGetUserMedia(r,e,function(a){t&&t(S(a))})})}.bind(v),v.mediaDevices.getUserMedia){var n=v.mediaDevices.getUserMedia.bind(v.mediaDevices);v.mediaDevices.getUserMedia=function(h){return k(h,function(i){return n(i).then(function(e){if(i.audio&&!e.getAudioTracks().length||i.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(t){t.stop()}),new DOMException("","NotFoundError");return e},function(e){return Promise.reject(S(e))})})}}}};var m=function p(_){if(_&&_.__esModule)return _;var P={};if(null!=_)for(var v in _)Object.prototype.hasOwnProperty.call(_,v)&&(P[v]=_[v]);return P.default=_,P}(x("../utils.js")).log},{"../utils.js":15}],6:[function(x,U,R){"use strict";Object.defineProperty(R,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};R.shimRTCIceCandidate=function P(n){if(!(!n.RTCIceCandidate||n.RTCIceCandidate&&"foundation"in n.RTCIceCandidate.prototype)){var h=n.RTCIceCandidate;n.RTCIceCandidate=function(e){if("object"===(typeof e>"u"?"undefined":c(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var t=new h(e),r=o.default.parseCandidate(e.candidate),a=Object.assign(t,r);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new h(e)},n.RTCIceCandidate.prototype=h.prototype,m.wrapPeerConnectionEvent(n,"icecandidate",function(i){return i.candidate&&Object.defineProperty(i,"candidate",{value:new n.RTCIceCandidate(i.candidate),writable:"false"}),i})}},R.shimMaxMessageSize=function v(n,h){if(n.RTCPeerConnection){"sctp"in n.RTCPeerConnection.prototype||Object.defineProperty(n.RTCPeerConnection.prototype,"sctp",{get:function(){return typeof this._sctp>"u"?null:this._sctp}});var i=function(d){if(!d||!d.sdp)return!1;var u=o.default.splitSections(d.sdp);return u.shift(),u.some(function(l){var T=o.default.parseMLine(l);return T&&"application"===T.kind&&-1!==T.protocol.indexOf("SCTP")})},e=function(d){var u=d.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===u||u.length<2)return-1;var l=parseInt(u[1],10);return l!=l?-1:l},t=function(d){var u=65536;return"firefox"===h.browser&&(u=h.version<57?-1===d?16384:2147483637:h.version<60?57===h.version?65535:65536:2147483637),u},r=function(d,u){var l=65536;"firefox"===h.browser&&57===h.version&&(l=65535);var T=o.default.matchPrefix(d.sdp,"a=max-message-size:");return T.length>0?l=parseInt(T[0].substr(19),10):"firefox"===h.browser&&-1!==u&&(l=2147483637),l},a=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===h.browser&&h.version>=76){var d=this.getConfiguration(),u=d.sdpSemantics;"plan-b"===u&&Object.defineProperty(this,"sctp",{get:function(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){var l=e(arguments[0]),T=t(l),g=r(arguments[0],l),y=void 0;y=0===T&&0===g?Number.POSITIVE_INFINITY:0===T||0===g?Math.max(T,g):Math.min(T,g);var M={};Object.defineProperty(M,"maxMessageSize",{get:function(){return y}}),this._sctp=M}return a.apply(this,arguments)}}},R.shimSendThrowTypeError=function E(n){if(n.RTCPeerConnection&&"createDataChannel"in n.RTCPeerConnection.prototype){var i=n.RTCPeerConnection.prototype.createDataChannel;n.RTCPeerConnection.prototype.createDataChannel=function(){var t=i.apply(this,arguments);return h(t,this),t},m.wrapPeerConnectionEvent(n,"datachannel",function(e){return h(e.channel,e.target),e})}function h(e,t){var r=e.send;e.send=function(){var f=arguments[0],d=f.length||f.size||f.byteLength;if("open"===e.readyState&&t.sctp&&d>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}},R.shimConnectionState=function k(n){if(n.RTCPeerConnection&&!("connectionState"in n.RTCPeerConnection.prototype)){var h=n.RTCPeerConnection.prototype;Object.defineProperty(h,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(h,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(i){var e=h[i];h[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(t){var r=t.target;if(r._lastConnectionState!==r.connectionState){r._lastConnectionState=r.connectionState;var a=new Event("connectionstatechange",t);r.dispatchEvent(a)}return t},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),e.apply(this,arguments)}})}},R.removeExtmapAllowMixed=function S(n,h){if(n.RTCPeerConnection&&!("chrome"===h.browser&&h.version>=71)&&!("safari"===h.browser&&h.version>=605)){var i=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){var r=t.sdp.split("\n").filter(function(a){return"a=extmap-allow-mixed"!==a.trim()}).join("\n");n.RTCSessionDescription&&t instanceof n.RTCSessionDescription?arguments[0]=new n.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return i.apply(this,arguments)}}},R.shimAddIceCandidateNullOrEmpty=function D(n,h){if(n.RTCPeerConnection&&n.RTCPeerConnection.prototype){var i=n.RTCPeerConnection.prototype.addIceCandidate;!i||0===i.length||(n.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===h.browser&&h.version<78||"firefox"===h.browser&&h.version<68||"safari"===h.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}};var o=function _(n){return n&&n.__esModule?n:{default:n}}(x("sdp")),m=function C(n){if(n&&n.__esModule)return n;var h={};if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(h[i]=n[i]);return h.default=n,h}(x("./utils"))},{"./utils":15,sdp:17}],7:[function(x,U,R){"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.shimGetDisplayMedia=R.shimGetUserMedia=void 0;var c=x("./getusermedia");Object.defineProperty(R,"shimGetUserMedia",{enumerable:!0,get:function(){return c.shimGetUserMedia}});var s=x("./getdisplaymedia");Object.defineProperty(R,"shimGetDisplayMedia",{enumerable:!0,get:function(){return s.shimGetDisplayMedia}}),R.shimPeerConnection=function E(S,D){if(S.RTCIceGatherer&&(S.RTCIceCandidate||(S.RTCIceCandidate=function(e){return e}),S.RTCSessionDescription||(S.RTCSessionDescription=function(e){return e}),D.version<15025)){var n=Object.getOwnPropertyDescriptor(S.MediaStreamTrack.prototype,"enabled");Object.defineProperty(S.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}S.RTCRtpSender&&!("dtmf"in S.RTCRtpSender.prototype)&&Object.defineProperty(S.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new S.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),S.RTCDtmfSender&&!S.RTCDTMFSender&&(S.RTCDTMFSender=S.RTCDtmfSender);var h=(0,_.default)(S,D.version);S.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,m.filterIceServers)(e.iceServers,D.version),p.log("ICE servers after filtering:",e.iceServers)),new h(e)},S.RTCPeerConnection.prototype=h.prototype},R.shimReplaceTrack=function k(S){S.RTCRtpSender&&!("replaceTrack"in S.RTCRtpSender.prototype)&&(S.RTCRtpSender.prototype.replaceTrack=S.RTCRtpSender.prototype.setTrack)};var p=function v(S){if(S&&S.__esModule)return S;var D={};if(null!=S)for(var n in S)Object.prototype.hasOwnProperty.call(S,n)&&(D[n]=S[n]);return D.default=S,D}(x("../utils")),m=x("./filtericeservers"),_=function P(S){return S&&S.__esModule?S:{default:S}}(x("rtcpeerconnection-shim"))},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(x,U,R){"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.filterIceServers=function p(m,C){var _=!1;return(m=JSON.parse(JSON.stringify(m))).filter(function(P){if(P&&(P.urls||P.url)){var v=P.urls||P.url;P.url&&!P.urls&&s.deprecated("RTCIceServer.url","RTCIceServer.urls");var E="string"==typeof v;return E&&(v=[v]),v=v.filter(function(k){if(0===k.indexOf("stun:"))return!1;var S=k.startsWith("turn")&&!k.startsWith("turn:[")&&k.includes("transport=udp");return S&&!_?(_=!0,!0):S&&!_}),delete P.url,P.urls=E?v[0]:v,!!v.length}})};var s=function o(m){if(m&&m.__esModule)return m;var C={};if(null!=m)for(var _ in m)Object.prototype.hasOwnProperty.call(m,_)&&(C[_]=m[_]);return C.default=m,C}(x("../utils"))},{"../utils":15}],9:[function(x,U,R){"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.shimGetDisplayMedia=function c(s){"getDisplayMedia"in s.navigator&&(!s.navigator.mediaDevices||s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||(s.navigator.mediaDevices.getDisplayMedia=s.navigator.getDisplayMedia.bind(s.navigator)))}},{}],10:[function(x,U,R){"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.shimGetUserMedia=function c(s){var o=s&&s.navigator,m=o.mediaDevices.getUserMedia.bind(o.mediaDevices);o.mediaDevices.getUserMedia=function(C){return m(C).catch(function(_){return Promise.reject(function(_){return{name:{PermissionDeniedError:"NotAllowedError"}[_.name]||_.name,message:_.message,constraint:_.constraint,toString:function(){return this.name}}}(_))})}}},{}],11:[function(x,U,R){"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.shimGetDisplayMedia=R.shimGetUserMedia=void 0;var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=x("./getusermedia");Object.defineProperty(R,"shimGetUserMedia",{enumerable:!0,get:function(){return s.shimGetUserMedia}});var o=x("./getdisplaymedia");Object.defineProperty(R,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}}),R.shimOnTrack=function P(t){"object"===(typeof t>"u"?"undefined":c(t))&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},R.shimPeerConnection=function v(t,r){if("object"===(typeof t>"u"?"undefined":c(t))&&(t.RTCPeerConnection||t.mozRTCPeerConnection)){!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(d){var u=t.RTCPeerConnection.prototype[d],l=function _(t,r,a){return r in t?Object.defineProperty(t,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[r]=a,t}({},d,function(){return arguments[0]=new("addIceCandidate"===d?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),u.apply(this,arguments)});t.RTCPeerConnection.prototype[d]=l[d]});var a={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},f=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){var u=Array.prototype.slice.call(arguments),l=u[0],T=u[1],g=u[2];return f.apply(this,[l||null]).then(function(y){if(r.version<53&&!T)try{y.forEach(function(M){M.type=a[M.type]||M.type})}catch(M){if("TypeError"!==M.name)throw M;y.forEach(function(b,O){y.set(O,Object.assign({},b,{type:a[b.type]||b.type}))})}return y}).then(T,g)}}},R.shimSenderGetStats=function E(t){if("object"===(typeof t>"u"?"undefined":c(t))&&t.RTCPeerConnection&&t.RTCRtpSender&&(!t.RTCRtpSender||!("getStats"in t.RTCRtpSender.prototype))){var r=t.RTCPeerConnection.prototype.getSenders;r&&(t.RTCPeerConnection.prototype.getSenders=function(){var d=this,u=r.apply(this,[]);return u.forEach(function(l){return l._pc=d}),u});var a=t.RTCPeerConnection.prototype.addTrack;a&&(t.RTCPeerConnection.prototype.addTrack=function(){var d=a.apply(this,arguments);return d._pc=this,d}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},R.shimReceiverGetStats=function k(t){if("object"===(typeof t>"u"?"undefined":c(t))&&t.RTCPeerConnection&&t.RTCRtpSender&&(!t.RTCRtpSender||!("getStats"in t.RTCRtpReceiver.prototype))){var r=t.RTCPeerConnection.prototype.getReceivers;r&&(t.RTCPeerConnection.prototype.getReceivers=function(){var f=this,d=r.apply(this,[]);return d.forEach(function(u){return u._pc=f}),d}),m.wrapPeerConnectionEvent(t,"track",function(a){return a.receiver._pc=a.srcElement,a}),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},R.shimRemoveStream=function S(t){!t.RTCPeerConnection||"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(a){var f=this;m.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(d){d.track&&a.getTracks().includes(d.track)&&f.removeTrack(d)})})},R.shimRTCDataChannel=function D(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)},R.shimAddTransceiver=function n(t){if("object"===(typeof t>"u"?"undefined":c(t))&&t.RTCPeerConnection){var r=t.RTCPeerConnection.prototype.addTransceiver;r&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var f=arguments[1],d=f&&"sendEncodings"in f;d&&f.sendEncodings.forEach(function(g){if("rid"in g&&!/^[a-z0-9]{0,16}$/i.test(g.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in g&&!(parseFloat(g.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in g&&!(parseFloat(g.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});var u=r.apply(this,arguments);if(d){var l=u.sender,T=l.getParameters();(!("encodings"in T)||1===T.encodings.length&&0===Object.keys(T.encodings[0]).length)&&(T.encodings=f.sendEncodings,l.sendEncodings=f.sendEncodings,this.setParametersPromises.push(l.setParameters(T).then(function(){delete l.sendEncodings}).catch(function(){delete l.sendEncodings})))}return u})}},R.shimGetParameters=function h(t){if("object"===(typeof t>"u"?"undefined":c(t))&&t.RTCRtpSender){var r=t.RTCRtpSender.prototype.getParameters;r&&(t.RTCRtpSender.prototype.getParameters=function(){var f=r.apply(this,arguments);return"encodings"in f||(f.encodings=[].concat(this.sendEncodings||[{}])),f})}},R.shimCreateOffer=function i(t){if("object"===(typeof t>"u"?"undefined":c(t))&&t.RTCPeerConnection){var r=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){var f=this,d=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return r.apply(f,d)}).finally(function(){f.setParametersPromises=[]}):r.apply(this,arguments)}}},R.shimCreateAnswer=function e(t){if("object"===(typeof t>"u"?"undefined":c(t))&&t.RTCPeerConnection){var r=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){var f=this,d=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return r.apply(f,d)}).finally(function(){f.setParametersPromises=[]}):r.apply(this,arguments)}}};var m=function C(t){if(t&&t.__esModule)return t;var r={};if(null!=t)for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(r[a]=t[a]);return r.default=t,r}(x("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(x,U,R){"use strict";Object.defineProperty(R,"__esModule",{value:!0}),R.shimGetDisplayMedia=function c(s,o){s.navigator.mediaDevices&&"getDisplayMedia"in s.navigator.mediaDevices||!s.navigator.mediaDevices||(s.navigator.mediaDevices.getDisplayMedia=function(m){if(!m||!m.video){var C=new DOMException("getDisplayMedia without video constraints is undefined");return C.name="NotFoundError",C.code=8,Promise.reject(C)}return!0===m.video?m.video={mediaSource:o}:m.video.mediaSource=o,s.navigator.mediaDevices.getUserMedia(m)})}},{}],13:[function(x,U,R){"use strict";Object.defineProperty(R,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(C){return typeof C}:function(C){return C&&"function"==typeof Symbol&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C};R.shimGetUserMedia=function m(C,_){var P=C&&C.navigator,v=C&&C.MediaStreamTrack;if(P.getUserMedia=function(n,h,i){o.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),P.mediaDevices.getUserMedia(n).then(h,i)},!(_.version>55&&"autoGainControl"in P.mediaDevices.getSupportedConstraints())){var E=function(h,i,e){i in h&&!(e in h)&&(h[e]=h[i],delete h[i])},k=P.mediaDevices.getUserMedia.bind(P.mediaDevices);if(P.mediaDevices.getUserMedia=function(n){return"object"===(typeof n>"u"?"undefined":c(n))&&"object"===c(n.audio)&&(n=JSON.parse(JSON.stringify(n)),E(n.audio,"autoGainControl","mozAutoGainControl"),E(n.audio,"noiseSuppression","mozNoiseSuppression")),k(n)},v&&v.prototype.getSettings){var S=v.prototype.getSettings;v.prototype.getSettings=function(){var n=S.apply(this,arguments);return E(n,"mozAutoGainControl","autoGainControl"),E(n,"mozNoiseSuppression","noiseSuppression"),n}}if(v&&v.prototype.applyConstraints){var D=v.prototype.applyConstraints;v.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"===(typeof n>"u"?"undefined":c(n))&&(n=JSON.parse(JSON.stringify(n)),E(n,"autoGainControl","mozAutoGainControl"),E(n,"noiseSuppression","mozNoiseSuppression")),D.apply(this,[n])}}}};var o=function p(C){if(C&&C.__esModule)return C;var _={};if(null!=C)for(var P in C)Object.prototype.hasOwnProperty.call(C,P)&&(_[P]=C[P]);return _.default=C,_}(x("../utils"))},{"../utils":15}],14:[function(x,U,R){"use strict";Object.defineProperty(R,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n};R.shimLocalStreamsAPI=function m(n){if("object"===(typeof n>"u"?"undefined":c(n))&&n.RTCPeerConnection){if("getLocalStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in n.RTCPeerConnection.prototype)){var h=n.RTCPeerConnection.prototype.addTrack;n.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach(function(r){return h.call(t,r,e)}),e.getVideoTracks().forEach(function(r){return h.call(t,r,e)})},n.RTCPeerConnection.prototype.addTrack=function(e){for(var t=this,r=arguments.length,a=Array(r>1?r-1:0),f=1;f<r;f++)a[f-1]=arguments[f];return a&&a.forEach(function(d){t._localStreams?t._localStreams.includes(d)||t._localStreams.push(d):t._localStreams=[d]}),h.apply(this,arguments)}}"removeStream"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var a=e.getTracks();this.getSenders().forEach(function(f){a.includes(f.track)&&t.removeTrack(f)})}})}},R.shimRemoteStreamsAPI=function C(n){if("object"===(typeof n>"u"?"undefined":c(n))&&n.RTCPeerConnection&&("getRemoteStreams"in n.RTCPeerConnection.prototype||(n.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in n.RTCPeerConnection.prototype))){Object.defineProperty(n.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(function(a){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(a)){t._remoteStreams.push(a);var f=new Event("addstream");f.stream=a,t.dispatchEvent(f)}})})}});var h=n.RTCPeerConnection.prototype.setRemoteDescription;n.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(r){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(r)>=0)){e._remoteStreams.push(r);var a=new Event("addstream");a.stream=r,e.dispatchEvent(a)}})}),h.apply(e,arguments)}}},R.shimCallbacksAPI=function _(n){if("object"===(typeof n>"u"?"undefined":c(n))&&n.RTCPeerConnection){var h=n.RTCPeerConnection.prototype,i=h.createOffer,e=h.createAnswer,t=h.setLocalDescription,r=h.setRemoteDescription,a=h.addIceCandidate;h.createOffer=function(u,l){var T=arguments.length>=2?arguments[2]:arguments[0],g=i.apply(this,[T]);return l?(g.then(u,l),Promise.resolve()):g},h.createAnswer=function(u,l){var T=arguments.length>=2?arguments[2]:arguments[0],g=e.apply(this,[T]);return l?(g.then(u,l),Promise.resolve()):g};var f=function(u,l,T){var g=t.apply(this,[u]);return T?(g.then(l,T),Promise.resolve()):g};h.setLocalDescription=f,h.setRemoteDescription=f=function(u,l,T){var g=r.apply(this,[u]);return T?(g.then(l,T),Promise.resolve()):g},h.addIceCandidate=f=function(u,l,T){var g=a.apply(this,[u]);return T?(g.then(l,T),Promise.resolve()):g}}},R.shimGetUserMedia=function P(n){var h=n&&n.navigator;if(h.mediaDevices&&h.mediaDevices.getUserMedia){var i=h.mediaDevices,e=i.getUserMedia.bind(i);h.mediaDevices.getUserMedia=function(t){return e(v(t))}}!h.getUserMedia&&h.mediaDevices&&h.mediaDevices.getUserMedia&&(h.getUserMedia=function(r,a,f){h.mediaDevices.getUserMedia(r).then(a,f)}.bind(h))},R.shimConstraints=v,R.shimRTCIceServerUrls=function E(n){if(n.RTCPeerConnection){var h=n.RTCPeerConnection;n.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var r=[],a=0;a<e.iceServers.length;a++){var f=e.iceServers[a];!f.hasOwnProperty("urls")&&f.hasOwnProperty("url")?(o.deprecated("RTCIceServer.url","RTCIceServer.urls"),(f=JSON.parse(JSON.stringify(f))).urls=f.url,delete f.url,r.push(f)):r.push(e.iceServers[a])}e.iceServers=r}return new h(e,t)},n.RTCPeerConnection.prototype=h.prototype,"generateCertificate"in h&&Object.defineProperty(n.RTCPeerConnection,"generateCertificate",{get:function(){return h.generateCertificate}})}},R.shimTrackEventTransceiver=function k(n){"object"===(typeof n>"u"?"undefined":c(n))&&n.RTCTrackEvent&&"receiver"in n.RTCTrackEvent.prototype&&!("transceiver"in n.RTCTrackEvent.prototype)&&Object.defineProperty(n.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},R.shimCreateOfferLegacy=function S(n){var h=n.RTCPeerConnection.prototype.createOffer;n.RTCPeerConnection.prototype.createOffer=function(e){if(e){typeof e.offerToReceiveAudio<"u"&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var t=this.getTransceivers().find(function(a){return"audio"===a.receiver.track.kind});!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0===e.offerToReceiveAudio&&!t&&this.addTransceiver("audio"),typeof e.offerToReceiveVideo<"u"&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var r=this.getTransceivers().find(function(a){return"video"===a.receiver.track.kind});!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0===e.offerToReceiveVideo&&!r&&this.addTransceiver("video")}return h.apply(this,arguments)}},R.shimAudioContext=function D(n){"object"!==(typeof n>"u"?"undefined":c(n))||n.AudioContext||(n.AudioContext=n.webkitAudioContext)};var o=function p(n){if(n&&n.__esModule)return n;var h={};if(null!=n)for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(h[i]=n[i]);return h.default=n,h}(x("../utils"));function v(n){return n&&void 0!==n.video?Object.assign({},n,{video:o.compactObject(n.video)}):n}},{"../utils":15}],15:[function(x,U,R){"use strict";Object.defineProperty(R,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i};R.extractVersion=m,R.wrapPeerConnectionEvent=function C(i,e,t){if(i.RTCPeerConnection){var r=i.RTCPeerConnection.prototype,a=r.addEventListener;r.addEventListener=function(d,u){if(d!==e)return a.apply(this,arguments);var l=function(g){var y=t(g);y&&(u.handleEvent?u.handleEvent(y):u(y))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(u,l),a.apply(this,[d,l])};var f=r.removeEventListener;r.removeEventListener=function(d,u){if(d!==e||!this._eventMap||!this._eventMap[e])return f.apply(this,arguments);if(!this._eventMap[e].has(u))return f.apply(this,arguments);var l=this._eventMap[e].get(u);return this._eventMap[e].delete(u),0===this._eventMap[e].size&&delete this._eventMap[e],0===Object.keys(this._eventMap).length&&delete this._eventMap,f.apply(this,[d,l])},Object.defineProperty(r,"on"+e,{get:function(){return this["_on"+e]},set:function(u){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),u&&this.addEventListener(e,this["_on"+e]=u)},enumerable:!0,configurable:!0})}},R.disableLog=function _(i){return"boolean"!=typeof i?new Error("Argument type: "+(typeof i>"u"?"undefined":c(i))+". Please use a boolean."):(o=i,i?"adapter.js logging disabled":"adapter.js logging enabled")},R.disableWarnings=function P(i){return"boolean"!=typeof i?new Error("Argument type: "+(typeof i>"u"?"undefined":c(i))+". Please use a boolean."):(p=!i,"adapter.js deprecation warnings "+(i?"disabled":"enabled"))},R.log=function v(){if("object"===(typeof window>"u"?"undefined":c(window))){if(o)return;typeof console<"u"&&"function"==typeof console.log&&console.log.apply(console,arguments)}},R.deprecated=function E(i,e){!p||console.warn(i+" is deprecated, please use "+e+" instead.")},R.detectBrowser=function k(i){var e={browser:null,version:null};if(typeof i>"u"||!i.navigator)return e.browser="Not a browser.",e;var t=i.navigator;if(t.mozGetUserMedia)e.browser="firefox",e.version=m(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===i.isSecureContext&&i.webkitRTCPeerConnection&&!i.RTCIceGatherer)e.browser="chrome",e.version=m(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=m(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!i.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=m(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=i.RTCRtpTransceiver&&"currentDirection"in i.RTCRtpTransceiver.prototype}return e},R.compactObject=function D(i){return S(i)?Object.keys(i).reduce(function(e,t){var r=S(i[t]),a=r?D(i[t]):i[t],f=r&&!Object.keys(a).length;return void 0===a||f?e:Object.assign(e,function s(i,e,t){return e in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}({},t,a))},{}):i},R.walkStats=n,R.filterStats=function h(i,e,t){var r=t?"outbound-rtp":"inbound-rtp",a=new Map;if(null===e)return a;var f=[];return i.forEach(function(d){"track"===d.type&&d.trackIdentifier===e.id&&f.push(d)}),f.forEach(function(d){i.forEach(function(u){u.type===r&&u.trackId===d.id&&n(i,u,a)})}),a};var o=!0,p=!0;function m(i,e,t){var r=i.match(e);return r&&r.length>=t&&parseInt(r[t],10)}function S(i){return"[object Object]"===Object.prototype.toString.call(i)}function n(i,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(function(r){r.endsWith("Id")?n(i,i.get(e[r]),t):r.endsWith("Ids")&&e[r].forEach(function(a){n(i,i.get(a),t)})}))}},{}],16:[function(x,U,R){"use strict";var c=x("sdp");function o(v,E,k,S,D){var n=c.writeRtpDescription(v.kind,E);if(n+=c.writeIceParameters(v.iceGatherer.getLocalParameters()),n+=c.writeDtlsParameters(v.dtlsTransport.getLocalParameters(),"offer"===k?"actpass":D||"active"),n+="a=mid:"+v.mid+"\r\n",n+=v.rtpSender&&v.rtpReceiver?"a=sendrecv\r\n":v.rtpSender?"a=sendonly\r\n":v.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",v.rtpSender){var h=v.rtpSender._initialTrackId||v.rtpSender.track.id;v.rtpSender._initialTrackId=h;var i="msid:"+(S?S.id:"-")+" "+h+"\r\n";n+="a="+i,n+="a=ssrc:"+v.sendEncodingParameters[0].ssrc+" "+i,v.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+v.sendEncodingParameters[0].rtx.ssrc+" "+i,n+="a=ssrc-group:FID "+v.sendEncodingParameters[0].ssrc+" "+v.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return n+="a=ssrc:"+v.sendEncodingParameters[0].ssrc+" cname:"+c.localCName+"\r\n",v.rtpSender&&v.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+v.sendEncodingParameters[0].rtx.ssrc+" cname:"+c.localCName+"\r\n"),n}function m(v,E){var k={codecs:[],headerExtensions:[],fecMechanisms:[]},S=function(n,h){n=parseInt(n,10);for(var i=0;i<h.length;i++)if(h[i].payloadType===n||h[i].preferredPayloadType===n)return h[i]},D=function(n,h,i,e){var t=S(n.parameters.apt,i),r=S(h.parameters.apt,e);return t&&r&&t.name.toLowerCase()===r.name.toLowerCase()};return v.codecs.forEach(function(n){for(var h=0;h<E.codecs.length;h++){var i=E.codecs[h];if(n.name.toLowerCase()===i.name.toLowerCase()&&n.clockRate===i.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&i.parameters.apt&&!D(n,i,v.codecs,E.codecs))continue;(i=JSON.parse(JSON.stringify(i))).numChannels=Math.min(n.numChannels,i.numChannels),k.codecs.push(i),i.rtcpFeedback=i.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),v.headerExtensions.forEach(function(n){for(var h=0;h<E.headerExtensions.length;h++){var i=E.headerExtensions[h];if(n.uri===i.uri){k.headerExtensions.push(i);break}}}),k}function C(v,E,k){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[E][v].indexOf(k)}function _(v,E){var k=v.getRemoteCandidates().find(function(S){return E.foundation===S.foundation&&E.ip===S.ip&&E.port===S.port&&E.priority===S.priority&&E.protocol===S.protocol&&E.type===S.type});return k||v.addRemoteCandidate(E),!k}function P(v,E){var k=new Error(E);return k.name=v,k.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[v],k}U.exports=function(v,E){function k(e,t){t.addTrack(e),t.dispatchEvent(new v.MediaStreamTrackEvent("addtrack",{track:e}))}function D(e,t,r,a){var f=new Event("track");f.track=t,f.receiver=r,f.transceiver={receiver:r},f.streams=a,v.setTimeout(function(){e._dispatchEvent("track",f)})}var n=function(e){var t=this,r=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(f){t[f]=r[f].bind(r)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",e=JSON.parse(JSON.stringify(e||{})),this.usingBundle="max-bundle"===e.bundlePolicy,"negotiate"===e.rtcpMuxPolicy)throw P("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(e.rtcpMuxPolicy||(e.rtcpMuxPolicy="require"),e.iceTransportPolicy){case"all":case"relay":break;default:e.iceTransportPolicy="all"}switch(e.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:e.bundlePolicy="balanced"}if(e.iceServers=function p(v,E){var k=!1;return(v=JSON.parse(JSON.stringify(v))).filter(function(S){if(S&&(S.urls||S.url)){var D=S.urls||S.url;S.url&&!S.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var n="string"==typeof D;return n&&(D=[D]),D=D.filter(function(h){return 0!==h.indexOf("turn:")||-1===h.indexOf("transport=udp")||-1!==h.indexOf("turn:[")||k?0===h.indexOf("stun:")&&E>=14393&&-1===h.indexOf("?transport=udp"):(k=!0,!0)}),delete S.url,S.urls=n?D[0]:D,!!D.length}})}(e.iceServers||[],E),this._iceGatherers=[],e.iceCandidatePoolSize)for(var a=e.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new v.RTCIceGatherer({iceServers:e.iceServers,gatherPolicy:e.iceTransportPolicy}));else e.iceCandidatePoolSize=0;this._config=e,this.transceivers=[],this._sdpSessionId=c.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(n.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(n.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),n.prototype.onicecandidate=null,n.prototype.onaddstream=null,n.prototype.ontrack=null,n.prototype.onremovestream=null,n.prototype.onsignalingstatechange=null,n.prototype.oniceconnectionstatechange=null,n.prototype.onconnectionstatechange=null,n.prototype.onicegatheringstatechange=null,n.prototype.onnegotiationneeded=null,n.prototype.ondatachannel=null,n.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},n.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},n.prototype.getConfiguration=function(){return this._config},n.prototype.getLocalStreams=function(){return this.localStreams},n.prototype.getRemoteStreams=function(){return this.remoteStreams},n.prototype._createTransceiver=function(e,t){var a={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&this.transceivers.length>0)a.iceTransport=this.transceivers[0].iceTransport,a.dtlsTransport=this.transceivers[0].dtlsTransport;else{var f=this._createIceAndDtlsTransports();a.iceTransport=f.iceTransport,a.dtlsTransport=f.dtlsTransport}return t||this.transceivers.push(a),a},n.prototype.addTrack=function(e,t){if(this._isClosed)throw P("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");if(this.transceivers.find(function(d){return d.track===e}))throw P("InvalidAccessError","Track already exists.");for(var a,f=0;f<this.transceivers.length;f++)!this.transceivers[f].track&&this.transceivers[f].kind===e.kind&&(a=this.transceivers[f]);return a||(a=this._createTransceiver(e.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(t)&&this.localStreams.push(t),a.track=e,a.stream=t,a.rtpSender=new v.RTCRtpSender(e,a.dtlsTransport),a.rtpSender},n.prototype.addStream=function(e){var t=this;if(E>=15025)e.getTracks().forEach(function(a){t.addTrack(a,e)});else{var r=e.clone();e.getTracks().forEach(function(a,f){var d=r.getTracks()[f];a.addEventListener("enabled",function(u){d.enabled=u.enabled})}),r.getTracks().forEach(function(a){t.addTrack(a,r)})}},n.prototype.removeTrack=function(e){if(this._isClosed)throw P("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(e instanceof v.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var t=this.transceivers.find(function(f){return f.rtpSender===e});if(!t)throw P("InvalidAccessError","Sender was not created by this connection.");var r=t.stream;t.rtpSender.stop(),t.rtpSender=null,t.track=null,t.stream=null,-1===this.transceivers.map(function(f){return f.stream}).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},n.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(r){var a=t.getSenders().find(function(f){return f.track===r});a&&t.removeTrack(a)})},n.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},n.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},n.prototype._createIceGatherer=function(e,t){var r=this;if(t&&e>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var a=new v.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(a,"state",{value:"new",writable:!0}),this.transceivers[e].bufferedCandidateEvents=[],this.transceivers[e].bufferCandidates=function(f){var d=!f.candidate||0===Object.keys(f.candidate).length;a.state=d?"completed":"gathering",null!==r.transceivers[e].bufferedCandidateEvents&&r.transceivers[e].bufferedCandidateEvents.push(f)},a.addEventListener("localcandidate",this.transceivers[e].bufferCandidates),a},n.prototype._gather=function(e,t){var r=this,a=this.transceivers[t].iceGatherer;if(!a.onlocalcandidate){var f=this.transceivers[t].bufferedCandidateEvents;this.transceivers[t].bufferedCandidateEvents=null,a.removeEventListener("localcandidate",this.transceivers[t].bufferCandidates),a.onlocalcandidate=function(d){if(!(r.usingBundle&&t>0)){var u=new Event("icecandidate");u.candidate={sdpMid:e,sdpMLineIndex:t};var l=d.candidate,T=!l||0===Object.keys(l).length;if(T)("new"===a.state||"gathering"===a.state)&&(a.state="completed");else{"new"===a.state&&(a.state="gathering"),l.component=1,l.ufrag=a.getLocalParameters().usernameFragment;var g=c.writeCandidate(l);u.candidate=Object.assign(u.candidate,c.parseCandidate(g)),u.candidate.candidate=g,u.candidate.toJSON=function(){return{candidate:u.candidate.candidate,sdpMid:u.candidate.sdpMid,sdpMLineIndex:u.candidate.sdpMLineIndex,usernameFragment:u.candidate.usernameFragment}}}var y=c.getMediaSections(r._localDescription.sdp);y[u.candidate.sdpMLineIndex]+=T?"a=end-of-candidates\r\n":"a="+u.candidate.candidate+"\r\n",r._localDescription.sdp=c.getDescription(r._localDescription.sdp)+y.join("");var M=r.transceivers.every(function(b){return b.iceGatherer&&"completed"===b.iceGatherer.state});"gathering"!==r.iceGatheringState&&(r.iceGatheringState="gathering",r._emitGatheringStateChange()),T||r._dispatchEvent("icecandidate",u),M&&(r._dispatchEvent("icecandidate",new Event("icecandidate")),r.iceGatheringState="complete",r._emitGatheringStateChange())}},v.setTimeout(function(){f.forEach(function(d){a.onlocalcandidate(d)})},0)}},n.prototype._createIceAndDtlsTransports=function(){var e=this,t=new v.RTCIceTransport(null);t.onicestatechange=function(){e._updateIceConnectionState(),e._updateConnectionState()};var r=new v.RTCDtlsTransport(t);return r.ondtlsstatechange=function(){e._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),e._updateConnectionState()},{iceTransport:t,dtlsTransport:r}},n.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var a=this.transceivers[e].dtlsTransport;a&&(delete a.ondtlsstatechange,delete a.onerror,delete this.transceivers[e].dtlsTransport)},n.prototype._transceive=function(e,t,r){var a=m(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(a.encodings=e.sendEncodingParameters,a.rtcp={cname:c.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(a.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(a)),r&&e.rtpReceiver&&a.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&E<15019&&e.recvEncodingParameters.forEach(function(f){delete f.rtx}),a.encodings=e.recvEncodingParameters.length?e.recvEncodingParameters:[{}],a.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(a.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(a.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(a))},n.prototype.setLocalDescription=function(e){var r,a,t=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(P("TypeError",'Unsupported type "'+e.type+'"'));if(!C("setLocalDescription",e.type,t.signalingState)||t._isClosed)return Promise.reject(P("InvalidStateError","Can not set local "+e.type+" in state "+t.signalingState));if("offer"===e.type)r=c.splitSections(e.sdp),a=r.shift(),r.forEach(function(d,u){var l=c.parseRtpParameters(d);t.transceivers[u].localCapabilities=l}),t.transceivers.forEach(function(d,u){t._gather(d.mid,u)});else if("answer"===e.type){r=c.splitSections(t._remoteDescription.sdp),a=r.shift();var f=c.matchPrefix(a,"a=ice-lite").length>0;r.forEach(function(d,u){var l=t.transceivers[u],T=l.iceGatherer,g=l.iceTransport,y=l.dtlsTransport,M=l.localCapabilities,b=l.remoteCapabilities;if(!(c.isRejected(d)&&0===c.matchPrefix(d,"a=bundle-only").length||l.rejected)){var G=c.getIceParameters(d,a),A=c.getDtlsParameters(d,a);f&&(A.role="server"),(!t.usingBundle||0===u)&&(t._gather(l.mid,u),"new"===g.state&&g.start(T,G,f?"controlling":"controlled"),"new"===y.state&&y.start(A));var L=m(M,b);t._transceive(l,L.codecs.length>0,!1)}})}return t._localDescription={type:e.type,sdp:e.sdp},t._updateSignalingState("offer"===e.type?"have-local-offer":"stable"),Promise.resolve()},n.prototype.setRemoteDescription=function(e){var t=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(P("TypeError",'Unsupported type "'+e.type+'"'));if(!C("setRemoteDescription",e.type,t.signalingState)||t._isClosed)return Promise.reject(P("InvalidStateError","Can not set remote "+e.type+" in state "+t.signalingState));var r={};t.remoteStreams.forEach(function(g){r[g.id]=g});var a=[],f=c.splitSections(e.sdp),d=f.shift(),u=c.matchPrefix(d,"a=ice-lite").length>0,l=c.matchPrefix(d,"a=group:BUNDLE ").length>0;t.usingBundle=l;var T=c.matchPrefix(d,"a=ice-options:")[0];return t.canTrickleIceCandidates=!!T&&T.substr(14).split(" ").indexOf("trickle")>=0,f.forEach(function(g,y){var M=c.splitLines(g),b=c.getKind(g),O=c.isRejected(g)&&0===c.matchPrefix(g,"a=bundle-only").length,G=M[0].substr(2).split(" ")[2],A=c.getDirection(g,d),L=c.parseMsid(g),F=c.getMid(g)||c.generateIdentifier();if(O||"application"===b&&("DTLS/SCTP"===G||"UDP/DTLS/SCTP"===G))t.transceivers[y]={mid:F,kind:b,protocol:G,rejected:!0};else{!O&&t.transceivers[y]&&t.transceivers[y].rejected&&(t.transceivers[y]=t._createTransceiver(b,!0));var I,Z,q,$,j,H,X,W,z,ee,Y,w=c.parseRtpParameters(g);O||(ee=c.getIceParameters(g,d),(Y=c.getDtlsParameters(g,d)).role="client"),X=c.parseRtpEncodingParameters(g);var te=c.parseRtcpParameters(g),re=c.matchPrefix(g,"a=end-of-candidates",d).length>0,V=c.matchPrefix(g,"a=candidate:").map(function(N){return c.parseCandidate(N)}).filter(function(N){return 1===N.component});if(("offer"===e.type||"answer"===e.type)&&!O&&l&&y>0&&t.transceivers[y]&&(t._disposeIceAndDtlsTransports(y),t.transceivers[y].iceGatherer=t.transceivers[0].iceGatherer,t.transceivers[y].iceTransport=t.transceivers[0].iceTransport,t.transceivers[y].dtlsTransport=t.transceivers[0].dtlsTransport,t.transceivers[y].rtpSender&&t.transceivers[y].rtpSender.setTransport(t.transceivers[0].dtlsTransport),t.transceivers[y].rtpReceiver&&t.transceivers[y].rtpReceiver.setTransport(t.transceivers[0].dtlsTransport)),"offer"!==e.type||O)"answer"!==e.type||O||(Z=(I=t.transceivers[y]).iceGatherer,q=I.iceTransport,$=I.dtlsTransport,j=I.rtpReceiver,H=I.sendEncodingParameters,W=I.localCapabilities,t.transceivers[y].recvEncodingParameters=X,t.transceivers[y].remoteCapabilities=w,t.transceivers[y].rtcpParameters=te,V.length&&"new"===q.state&&(!u&&!re||l&&0!==y?V.forEach(function(N){_(I.iceTransport,N)}):q.setRemoteCandidates(V)),(!l||0===y)&&("new"===q.state&&q.start(Z,ee,"controlling"),"new"===$.state&&$.start(Y)),!m(I.localCapabilities,I.remoteCapabilities).codecs.filter(function(N){return"rtx"===N.name.toLowerCase()}).length&&I.sendEncodingParameters[0].rtx&&delete I.sendEncodingParameters[0].rtx,t._transceive(I,"sendrecv"===A||"recvonly"===A,"sendrecv"===A||"sendonly"===A),!j||"sendrecv"!==A&&"sendonly"!==A?delete I.rtpReceiver:(z=j.track,L?(r[L.stream]||(r[L.stream]=new v.MediaStream),k(z,r[L.stream]),a.push([z,j,r[L.stream]])):(r.default||(r.default=new v.MediaStream),k(z,r.default),a.push([z,j,r.default]))));else{(I=t.transceivers[y]||t._createTransceiver(b)).mid=F,I.iceGatherer||(I.iceGatherer=t._createIceGatherer(y,l)),V.length&&"new"===I.iceTransport.state&&(!re||l&&0!==y?V.forEach(function(N){_(I.iceTransport,N)}):I.iceTransport.setRemoteCandidates(V)),W=v.RTCRtpReceiver.getCapabilities(b),E<15019&&(W.codecs=W.codecs.filter(function(N){return"rtx"!==N.name})),H=I.sendEncodingParameters||[{ssrc:1001*(2*y+2)}];var B,Q=!1;"sendrecv"===A||"sendonly"===A?(Q=!I.rtpReceiver,j=I.rtpReceiver||new v.RTCRtpReceiver(I.dtlsTransport,b),Q&&(z=j.track,L&&"-"===L.stream||(L?(r[L.stream]||(r[L.stream]=new v.MediaStream,Object.defineProperty(r[L.stream],"id",{get:function(){return L.stream}})),Object.defineProperty(z,"id",{get:function(){return L.track}}),B=r[L.stream]):(r.default||(r.default=new v.MediaStream),B=r.default)),B&&(k(z,B),I.associatedRemoteMediaStreams.push(B)),a.push([z,j,B]))):I.rtpReceiver&&I.rtpReceiver.track&&(I.associatedRemoteMediaStreams.forEach(function(N){var ne=N.getTracks().find(function(se){return se.id===I.rtpReceiver.track.id});ne&&function S(e,t){t.removeTrack(e),t.dispatchEvent(new v.MediaStreamTrackEvent("removetrack",{track:e}))}(ne,N)}),I.associatedRemoteMediaStreams=[]),I.localCapabilities=W,I.remoteCapabilities=w,I.rtpReceiver=j,I.rtcpParameters=te,I.sendEncodingParameters=H,I.recvEncodingParameters=X,t._transceive(t.transceivers[y],!1,Q)}}}),void 0===t._dtlsRole&&(t._dtlsRole="offer"===e.type?"active":"passive"),t._remoteDescription={type:e.type,sdp:e.sdp},t._updateSignalingState("offer"===e.type?"have-remote-offer":"stable"),Object.keys(r).forEach(function(g){var y=r[g];if(y.getTracks().length){if(-1===t.remoteStreams.indexOf(y)){t.remoteStreams.push(y);var M=new Event("addstream");M.stream=y,v.setTimeout(function(){t._dispatchEvent("addstream",M)})}a.forEach(function(b){y.id===b[2].id&&D(t,b[0],b[1],[y])})}}),a.forEach(function(g){g[2]||D(t,g[0],g[1],[])}),v.setTimeout(function(){!t||!t.transceivers||t.transceivers.forEach(function(g){g.iceTransport&&"new"===g.iceTransport.state&&g.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),g.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},n.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},n.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},n.prototype._maybeFireNegotiationNeeded=function(){var e=this;"stable"!==this.signalingState||!0===this.needNegotiation||(this.needNegotiation=!0,v.setTimeout(function(){if(e.needNegotiation){e.needNegotiation=!1;var t=new Event("negotiationneeded");e._dispatchEvent("negotiationneeded",t)}},0))},n.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(a){a.iceTransport&&!a.rejected&&t[a.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},n.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(a){a.iceTransport&&a.dtlsTransport&&!a.rejected&&(t[a.iceTransport.state]++,t[a.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},n.prototype.createOffer=function(){var e=this;if(e._isClosed)return Promise.reject(P("InvalidStateError","Can not call createOffer after close"));var t=e.transceivers.filter(function(u){return"audio"===u.kind}).length,r=e.transceivers.filter(function(u){return"video"===u.kind}).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(t=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(r=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(e.transceivers.forEach(function(u){"audio"===u.kind?--t<0&&(u.wantReceive=!1):"video"===u.kind&&--r<0&&(u.wantReceive=!1)});t>0||r>0;)t>0&&(e._createTransceiver("audio"),t--),r>0&&(e._createTransceiver("video"),r--);var f=c.writeSessionBoilerplate(e._sdpSessionId,e._sdpSessionVersion++);e.transceivers.forEach(function(u,l){var T=u.track,g=u.kind,y=u.mid||c.generateIdentifier();u.mid=y,u.iceGatherer||(u.iceGatherer=e._createIceGatherer(l,e.usingBundle));var M=v.RTCRtpSender.getCapabilities(g);E<15019&&(M.codecs=M.codecs.filter(function(O){return"rtx"!==O.name})),M.codecs.forEach(function(O){"H264"===O.name&&void 0===O.parameters["level-asymmetry-allowed"]&&(O.parameters["level-asymmetry-allowed"]="1"),u.remoteCapabilities&&u.remoteCapabilities.codecs&&u.remoteCapabilities.codecs.forEach(function(G){O.name.toLowerCase()===G.name.toLowerCase()&&O.clockRate===G.clockRate&&(O.preferredPayloadType=G.payloadType)})}),M.headerExtensions.forEach(function(O){(u.remoteCapabilities&&u.remoteCapabilities.headerExtensions||[]).forEach(function(A){O.uri===A.uri&&(O.id=A.id)})});var b=u.sendEncodingParameters||[{ssrc:1001*(2*l+1)}];T&&E>=15019&&"video"===g&&!b[0].rtx&&(b[0].rtx={ssrc:b[0].ssrc+1}),u.wantReceive&&(u.rtpReceiver=new v.RTCRtpReceiver(u.dtlsTransport,g)),u.localCapabilities=M,u.sendEncodingParameters=b}),"max-compat"!==e._config.bundlePolicy&&(f+="a=group:BUNDLE "+e.transceivers.map(function(u){return u.mid}).join(" ")+"\r\n"),f+="a=ice-options:trickle\r\n",e.transceivers.forEach(function(u,l){f+=o(u,u.localCapabilities,"offer",u.stream,e._dtlsRole),f+="a=rtcp-rsize\r\n",u.iceGatherer&&"new"!==e.iceGatheringState&&(0===l||!e.usingBundle)&&(u.iceGatherer.getLocalCandidates().forEach(function(T){T.component=1,f+="a="+c.writeCandidate(T)+"\r\n"}),"completed"===u.iceGatherer.state&&(f+="a=end-of-candidates\r\n"))});var d=new v.RTCSessionDescription({type:"offer",sdp:f});return Promise.resolve(d)},n.prototype.createAnswer=function(){var e=this;if(e._isClosed)return Promise.reject(P("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==e.signalingState&&"have-local-pranswer"!==e.signalingState)return Promise.reject(P("InvalidStateError","Can not call createAnswer in signalingState "+e.signalingState));var t=c.writeSessionBoilerplate(e._sdpSessionId,e._sdpSessionVersion++);e.usingBundle&&(t+="a=group:BUNDLE "+e.transceivers.map(function(f){return f.mid}).join(" ")+"\r\n"),t+="a=ice-options:trickle\r\n";var r=c.getMediaSections(e._remoteDescription.sdp).length;e.transceivers.forEach(function(f,d){if(!(d+1>r)){if(f.rejected)return"application"===f.kind?t+="DTLS/SCTP"===f.protocol?"m=application 0 DTLS/SCTP 5000\r\n":"m=application 0 "+f.protocol+" webrtc-datachannel\r\n":"audio"===f.kind?t+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===f.kind&&(t+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(t+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+f.mid+"\r\n");var u;f.stream&&("audio"===f.kind?u=f.stream.getAudioTracks()[0]:"video"===f.kind&&(u=f.stream.getVideoTracks()[0]),u&&E>=15019&&"video"===f.kind&&!f.sendEncodingParameters[0].rtx&&(f.sendEncodingParameters[0].rtx={ssrc:f.sendEncodingParameters[0].ssrc+1}));var l=m(f.localCapabilities,f.remoteCapabilities);!l.codecs.filter(function(g){return"rtx"===g.name.toLowerCase()}).length&&f.sendEncodingParameters[0].rtx&&delete f.sendEncodingParameters[0].rtx,t+=o(f,l,"answer",f.stream,e._dtlsRole),f.rtcpParameters&&f.rtcpParameters.reducedSize&&(t+="a=rtcp-rsize\r\n")}});var a=new v.RTCSessionDescription({type:"answer",sdp:t});return Promise.resolve(a)},n.prototype.addIceCandidate=function(e){var r,t=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(a,f){if(!t._remoteDescription)return f(P("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var u=e.sdpMLineIndex;if(e.sdpMid)for(var l=0;l<t.transceivers.length;l++)if(t.transceivers[l].mid===e.sdpMid){u=l;break}var T=t.transceivers[u];if(!T)return f(P("OperationError","Can not add ICE candidate"));if(T.rejected)return a();var g=Object.keys(e.candidate).length>0?c.parseCandidate(e.candidate):{};if("tcp"===g.protocol&&(0===g.port||9===g.port)||g.component&&1!==g.component)return a();if((0===u||u>0&&T.iceTransport!==t.transceivers[0].iceTransport)&&!_(T.iceTransport,g))return f(P("OperationError","Can not add ICE candidate"));var y=e.candidate.trim();0===y.indexOf("a=")&&(y=y.substr(2)),(r=c.getMediaSections(t._remoteDescription.sdp))[u]+="a="+(g.type?y:"end-of-candidates")+"\r\n",t._remoteDescription.sdp=c.getDescription(t._remoteDescription.sdp)+r.join("")}else for(var d=0;d<t.transceivers.length&&(t.transceivers[d].rejected||(t.transceivers[d].iceTransport.addRemoteCandidate({}),(r=c.getMediaSections(t._remoteDescription.sdp))[d]+="a=end-of-candidates\r\n",t._remoteDescription.sdp=c.getDescription(t._remoteDescription.sdp)+r.join(""),!t.usingBundle));d++);a()})},n.prototype.getStats=function(e){if(e&&e instanceof v.MediaStreamTrack){var t=null;if(this.transceivers.forEach(function(a){a.rtpSender&&a.rtpSender.track===e?t=a.rtpSender:a.rtpReceiver&&a.rtpReceiver.track===e&&(t=a.rtpReceiver)}),!t)throw P("InvalidAccessError","Invalid selector.");return t.getStats()}var r=[];return this.transceivers.forEach(function(a){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(f){a[f]&&r.push(a[f].getStats())})}),Promise.all(r).then(function(a){var f=new Map;return a.forEach(function(d){d.forEach(function(u){f.set(u.id,u)})}),f})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(e){var t=v[e];if(t&&t.prototype&&t.prototype.getStats){var r=t.prototype.getStats;t.prototype.getStats=function(){return r.apply(this).then(function(a){var f=new Map;return Object.keys(a).forEach(function(d){a[d].type=function s(v){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[v.type]||v.type}(a[d]),f.set(d,a[d])}),f})}}});var i=["createOffer","createAnswer"];return i.forEach(function(e){var t=n.prototype[e];n.prototype[e]=function(){var r=arguments;return"function"==typeof r[0]||"function"==typeof r[1]?t.apply(this,[arguments[2]]).then(function(a){"function"==typeof r[0]&&r[0].apply(null,[a])},function(a){"function"==typeof r[1]&&r[1].apply(null,[a])}):t.apply(this,arguments)}}),(i=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=n.prototype[e];n.prototype[e]=function(){var r=arguments;return"function"==typeof r[1]||"function"==typeof r[2]?t.apply(this,arguments).then(function(){"function"==typeof r[1]&&r[1].apply(null)},function(a){"function"==typeof r[2]&&r[2].apply(null,[a])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=n.prototype[e];n.prototype[e]=function(){var r=arguments;return"function"==typeof r[1]?t.apply(this,arguments).then(function(){"function"==typeof r[1]&&r[1].apply(null)}):t.apply(this,arguments)}}),n}},{sdp:17}],17:[function(x,U,R){"use strict";var c={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};c.localCName=c.generateIdentifier(),c.splitLines=function(s){return s.trim().split("\n").map(function(o){return o.trim()})},c.splitSections=function(s){return s.split("\nm=").map(function(p,m){return(m>0?"m="+p:p).trim()+"\r\n"})},c.getDescription=function(s){var o=c.splitSections(s);return o&&o[0]},c.getMediaSections=function(s){var o=c.splitSections(s);return o.shift(),o},c.matchPrefix=function(s,o){return c.splitLines(s).filter(function(p){return 0===p.indexOf(o)})},c.parseCandidate=function(s){for(var o,p={foundation:(o=0===s.indexOf("a=candidate:")?s.substring(12).split(" "):s.substring(10).split(" "))[0],component:parseInt(o[1],10),protocol:o[2].toLowerCase(),priority:parseInt(o[3],10),ip:o[4],address:o[4],port:parseInt(o[5],10),type:o[7]},m=8;m<o.length;m+=2)switch(o[m]){case"raddr":p.relatedAddress=o[m+1];break;case"rport":p.relatedPort=parseInt(o[m+1],10);break;case"tcptype":p.tcpType=o[m+1];break;case"ufrag":p.ufrag=o[m+1],p.usernameFragment=o[m+1];break;default:p[o[m]]=o[m+1]}return p},c.writeCandidate=function(s){var o=[];o.push(s.foundation),o.push(s.component),o.push(s.protocol.toUpperCase()),o.push(s.priority),o.push(s.address||s.ip),o.push(s.port);var p=s.type;return o.push("typ"),o.push(p),"host"!==p&&s.relatedAddress&&s.relatedPort&&(o.push("raddr"),o.push(s.relatedAddress),o.push("rport"),o.push(s.relatedPort)),s.tcpType&&"tcp"===s.protocol.toLowerCase()&&(o.push("tcptype"),o.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(o.push("ufrag"),o.push(s.usernameFragment||s.ufrag)),"candidate:"+o.join(" ")},c.parseIceOptions=function(s){return s.substr(14).split(" ")},c.parseRtpMap=function(s){var o=s.substr(9).split(" "),p={payloadType:parseInt(o.shift(),10)};return o=o[0].split("/"),p.name=o[0],p.clockRate=parseInt(o[1],10),p.channels=3===o.length?parseInt(o[2],10):1,p.numChannels=p.channels,p},c.writeRtpMap=function(s){var o=s.payloadType;void 0!==s.preferredPayloadType&&(o=s.preferredPayloadType);var p=s.channels||s.numChannels||1;return"a=rtpmap:"+o+" "+s.name+"/"+s.clockRate+(1!==p?"/"+p:"")+"\r\n"},c.parseExtmap=function(s){var o=s.substr(9).split(" ");return{id:parseInt(o[0],10),direction:o[0].indexOf("/")>0?o[0].split("/")[1]:"sendrecv",uri:o[1]}},c.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&"sendrecv"!==s.direction?"/"+s.direction:"")+" "+s.uri+"\r\n"},c.parseFmtp=function(s){for(var p,o={},m=s.substr(s.indexOf(" ")+1).split(";"),C=0;C<m.length;C++)o[(p=m[C].trim().split("="))[0].trim()]=p[1];return o},c.writeFmtp=function(s){var o="",p=s.payloadType;if(void 0!==s.preferredPayloadType&&(p=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){var m=[];Object.keys(s.parameters).forEach(function(C){m.push(s.parameters[C]?C+"="+s.parameters[C]:C)}),o+="a=fmtp:"+p+" "+m.join(";")+"\r\n"}return o},c.parseRtcpFb=function(s){var o=s.substr(s.indexOf(" ")+1).split(" ");return{type:o.shift(),parameter:o.join(" ")}},c.writeRtcpFb=function(s){var o="",p=s.payloadType;return void 0!==s.preferredPayloadType&&(p=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(function(m){o+="a=rtcp-fb:"+p+" "+m.type+(m.parameter&&m.parameter.length?" "+m.parameter:"")+"\r\n"}),o},c.parseSsrcMedia=function(s){var o=s.indexOf(" "),p={ssrc:parseInt(s.substr(7,o-7),10)},m=s.indexOf(":",o);return m>-1?(p.attribute=s.substr(o+1,m-o-1),p.value=s.substr(m+1)):p.attribute=s.substr(o+1),p},c.parseSsrcGroup=function(s){var o=s.substr(13).split(" ");return{semantics:o.shift(),ssrcs:o.map(function(p){return parseInt(p,10)})}},c.getMid=function(s){var o=c.matchPrefix(s,"a=mid:")[0];if(o)return o.substr(6)},c.parseFingerprint=function(s){var o=s.substr(14).split(" ");return{algorithm:o[0].toLowerCase(),value:o[1]}},c.getDtlsParameters=function(s,o){return{role:"auto",fingerprints:c.matchPrefix(s+o,"a=fingerprint:").map(c.parseFingerprint)}},c.writeDtlsParameters=function(s,o){var p="a=setup:"+o+"\r\n";return s.fingerprints.forEach(function(m){p+="a=fingerprint:"+m.algorithm+" "+m.value+"\r\n"}),p},c.parseCryptoLine=function(s){var o=s.substr(9).split(" ");return{tag:parseInt(o[0],10),cryptoSuite:o[1],keyParams:o[2],sessionParams:o.slice(3)}},c.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+("object"==typeof s.keyParams?c.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+"\r\n"},c.parseCryptoKeyParams=function(s){if(0!==s.indexOf("inline:"))return null;var o=s.substr(7).split("|");return{keyMethod:"inline",keySalt:o[0],lifeTime:o[1],mkiValue:o[2]?o[2].split(":")[0]:void 0,mkiLength:o[2]?o[2].split(":")[1]:void 0}},c.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},c.getCryptoParameters=function(s,o){return c.matchPrefix(s+o,"a=crypto:").map(c.parseCryptoLine)},c.getIceParameters=function(s,o){var p=c.matchPrefix(s+o,"a=ice-ufrag:")[0],m=c.matchPrefix(s+o,"a=ice-pwd:")[0];return p&&m?{usernameFragment:p.substr(12),password:m.substr(10)}:null},c.writeIceParameters=function(s){return"a=ice-ufrag:"+s.usernameFragment+"\r\na=ice-pwd:"+s.password+"\r\n"},c.parseRtpParameters=function(s){for(var o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},m=c.splitLines(s)[0].split(" "),C=3;C<m.length;C++){var _=m[C],P=c.matchPrefix(s,"a=rtpmap:"+_+" ")[0];if(P){var v=c.parseRtpMap(P),E=c.matchPrefix(s,"a=fmtp:"+_+" ");switch(v.parameters=E.length?c.parseFmtp(E[0]):{},v.rtcpFeedback=c.matchPrefix(s,"a=rtcp-fb:"+_+" ").map(c.parseRtcpFb),o.codecs.push(v),v.name.toUpperCase()){case"RED":case"ULPFEC":o.fecMechanisms.push(v.name.toUpperCase())}}}return c.matchPrefix(s,"a=extmap:").forEach(function(k){o.headerExtensions.push(c.parseExtmap(k))}),o},c.writeRtpDescription=function(s,o){var p="";p+="m="+s+" ",p+=o.codecs.length>0?"9":"0",p+=" UDP/TLS/RTP/SAVPF ",p+=o.codecs.map(function(C){return void 0!==C.preferredPayloadType?C.preferredPayloadType:C.payloadType}).join(" ")+"\r\n",p+="c=IN IP4 0.0.0.0\r\n",p+="a=rtcp:9 IN IP4 0.0.0.0\r\n",o.codecs.forEach(function(C){p+=c.writeRtpMap(C),p+=c.writeFmtp(C),p+=c.writeRtcpFb(C)});var m=0;return o.codecs.forEach(function(C){C.maxptime>m&&(m=C.maxptime)}),m>0&&(p+="a=maxptime:"+m+"\r\n"),p+="a=rtcp-mux\r\n",o.headerExtensions&&o.headerExtensions.forEach(function(C){p+=c.writeExtmap(C)}),p},c.parseRtpEncodingParameters=function(s){var v,o=[],p=c.parseRtpParameters(s),m=-1!==p.fecMechanisms.indexOf("RED"),C=-1!==p.fecMechanisms.indexOf("ULPFEC"),_=c.matchPrefix(s,"a=ssrc:").map(function(S){return c.parseSsrcMedia(S)}).filter(function(S){return"cname"===S.attribute}),P=_.length>0&&_[0].ssrc,E=c.matchPrefix(s,"a=ssrc-group:FID").map(function(S){return S.substr(17).split(" ").map(function(n){return parseInt(n,10)})});E.length>0&&E[0].length>1&&E[0][0]===P&&(v=E[0][1]),p.codecs.forEach(function(S){if("RTX"===S.name.toUpperCase()&&S.parameters.apt){var D={ssrc:P,codecPayloadType:parseInt(S.parameters.apt,10)};P&&v&&(D.rtx={ssrc:v}),o.push(D),m&&((D=JSON.parse(JSON.stringify(D))).fec={ssrc:P,mechanism:C?"red+ulpfec":"red"},o.push(D))}}),0===o.length&&P&&o.push({ssrc:P});var k=c.matchPrefix(s,"b=");return k.length&&(k=0===k[0].indexOf("b=TIAS:")?parseInt(k[0].substr(7),10):0===k[0].indexOf("b=AS:")?1e3*parseInt(k[0].substr(5),10)*.95-16e3:void 0,o.forEach(function(S){S.maxBitrate=k})),o},c.parseRtcpParameters=function(s){var o={},p=c.matchPrefix(s,"a=ssrc:").map(function(_){return c.parseSsrcMedia(_)}).filter(function(_){return"cname"===_.attribute})[0];p&&(o.cname=p.value,o.ssrc=p.ssrc);var m=c.matchPrefix(s,"a=rtcp-rsize");o.reducedSize=m.length>0,o.compound=0===m.length;var C=c.matchPrefix(s,"a=rtcp-mux");return o.mux=C.length>0,o},c.parseMsid=function(s){var o,p=c.matchPrefix(s,"a=msid:");if(1===p.length)return{stream:(o=p[0].substr(7).split(" "))[0],track:o[1]};var m=c.matchPrefix(s,"a=ssrc:").map(function(C){return c.parseSsrcMedia(C)}).filter(function(C){return"msid"===C.attribute});return m.length>0?{stream:(o=m[0].value.split(" "))[0],track:o[1]}:void 0},c.parseSctpDescription=function(s){var m,o=c.parseMLine(s),p=c.matchPrefix(s,"a=max-message-size:");p.length>0&&(m=parseInt(p[0].substr(19),10)),isNaN(m)&&(m=65536);var C=c.matchPrefix(s,"a=sctp-port:");if(C.length>0)return{port:parseInt(C[0].substr(12),10),protocol:o.fmt,maxMessageSize:m};if(c.matchPrefix(s,"a=sctpmap:").length>0){var P=c.matchPrefix(s,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(P[0],10),protocol:P[1],maxMessageSize:m}}},c.writeSctpDescription=function(s,o){var p=[];return p="DTLS/SCTP"!==s.protocol?["m="+s.kind+" 9 "+s.protocol+" "+o.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+o.port+"\r\n"]:["m="+s.kind+" 9 "+s.protocol+" "+o.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+o.port+" "+o.protocol+" 65535\r\n"],void 0!==o.maxMessageSize&&p.push("a=max-message-size:"+o.maxMessageSize+"\r\n"),p.join("")},c.generateSessionId=function(){return Math.random().toString().substr(2,21)},c.writeSessionBoilerplate=function(s,o,p){var C=void 0!==o?o:2;return"v=0\r\no="+(p||"thisisadapterortc")+" "+(s||c.generateSessionId())+" "+C+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},c.writeMediaSection=function(s,o,p,m){var C=c.writeRtpDescription(s.kind,o);if(C+=c.writeIceParameters(s.iceGatherer.getLocalParameters()),C+=c.writeDtlsParameters(s.dtlsTransport.getLocalParameters(),"offer"===p?"actpass":"active"),C+="a=mid:"+s.mid+"\r\n",C+=s.direction?"a="+s.direction+"\r\n":s.rtpSender&&s.rtpReceiver?"a=sendrecv\r\n":s.rtpSender?"a=sendonly\r\n":s.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",s.rtpSender){var _="msid:"+m.id+" "+s.rtpSender.track.id+"\r\n";C+="a="+_,C+="a=ssrc:"+s.sendEncodingParameters[0].ssrc+" "+_,s.sendEncodingParameters[0].rtx&&(C+="a=ssrc:"+s.sendEncodingParameters[0].rtx.ssrc+" "+_,C+="a=ssrc-group:FID "+s.sendEncodingParameters[0].ssrc+" "+s.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return C+="a=ssrc:"+s.sendEncodingParameters[0].ssrc+" cname:"+c.localCName+"\r\n",s.rtpSender&&s.sendEncodingParameters[0].rtx&&(C+="a=ssrc:"+s.sendEncodingParameters[0].rtx.ssrc+" cname:"+c.localCName+"\r\n"),C},c.getDirection=function(s,o){for(var p=c.splitLines(s),m=0;m<p.length;m++)switch(p[m]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return p[m].substr(2)}return o?c.getDirection(o):"sendrecv"},c.getKind=function(s){return c.splitLines(s)[0].split(" ")[0].substr(2)},c.isRejected=function(s){return"0"===s.split(" ",2)[1]},c.parseMLine=function(s){var p=c.splitLines(s)[0].substr(2).split(" ");return{kind:p[0],port:parseInt(p[1],10),protocol:p[2],fmt:p.slice(3).join(" ")}},c.parseOLine=function(s){var p=c.matchPrefix(s,"o=")[0].substr(2).split(" ");return{username:p[0],sessionId:p[1],sessionVersion:parseInt(p[2],10),netType:p[3],addressType:p[4],address:p[5]}},c.isValidSDP=function(s){if("string"!=typeof s||0===s.length)return!1;for(var o=c.splitLines(s),p=0;p<o.length;p++)if(o[p].length<2||"="!==o[p].charAt(1))return!1;return!0},"object"==typeof U&&(U.exports=c)},{}]},{},[1])(1)});